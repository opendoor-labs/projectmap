<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Alex Hubbard" />

<meta name="date" content="2018-09-05" />

<title>Project Map</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Project Map</h1>
<h4 class="author"><em>Alex Hubbard</em></h4>
<h4 class="date"><em>September 05, 2018</em></h4>



<div id="description" class="section level2">
<h2>Description</h2>
<p>It can be a challenge to develop a project in RStudio with multiple authors and make the results repeatable on any machine. It can be especially challenging to collaborate on a project developed in RStudio when output from one author’s scripts is used as an input by another author. It can also be frustrating when the scripts writted by one author are run on another author’s computer missing the required packages. Not to mention, shared drives may have differing names across computers, which can cause file input and output to break if paths are hardcoded without the using paths relative to the root directory. Finally, it can be a nightmare to setting the correct working directory. All of these challenges are addressed in the <strong>projectmap</strong> package by attempting to standardize folder structure and file input/output while also performing package version control. The package also allows users to branch files and work on them separately from the master a method for version controlling files.</p>
</div>
<div id="installing-the-package" class="section level2">
<h2>Installing the Package</h2>
<p>To install the <strong>projectmap</strong> package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;opendoor-labs/projectmap&quot;</span>)</a></code></pre></div>
</div>
<div id="setting-up-a-project" class="section level2">
<h2>Setting up a Project</h2>
<p>Once the installation is complete, you can now set up a new project using the package. Open RStudio and in the console type:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(projectmap)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">link_to_proj</span>()</a></code></pre></div>
<p>You will be prompted to select a directory to build your new project in. It is suggested that you create a new folder. Once the function finishes executing, you will see folders <em>Codes</em>, <em>Documentation</em>, <em>Functions</em>, <em>Input</em>, <em>Libary</em>, <em>Logs</em>, and <em>Output</em> along with two files <em>Example File.R</em> and <em>Project Master.R</em>. Do not change the name or move <em>Project Master.R</em>. The name and location of this file is how <strong>projectmap</strong> finds the working directory.</p>
<p>Once the package is loaded, <strong>projectmap</strong> creates a hidden environment variable called <em>proj.env</em>, that maintains a list variables essential for the package functions to operate correctly. You should be able to delete it or edit it without unlocking it first using the <em>unlock_proj()</em> funciton. It is not recommended to make any changes to the <em>proj.env</em> variables, but if you do, make sure to lock it when you are done using the <em>lock_proj()</em> function.</p>
<p>The <em>link_to_proj()</em> function is the workhorse function for the <strong>projectmap</strong> package. It is responsible for building the folder structure, adding a new library path to your RStudio session, installing all of the required packages into the projects directory, and building a file <em>cabinet</em> of all files in the directory. It also creates a color palette (a vector of hexidecimal strings with names called <em>od.colors</em>) and ggplot theme (<em>od_theme()</em>) based on Opendoor’s color palette from the Google Slides template. This function also creates a “.gitignore” file and initializes the root directory as a git repository in case the user would like to use git features with the project.</p>
<p>The <em>cabinet</em> maintains a list of file paths relative to the root directory (using the “./” syntax which replaces the folder path of the root directory) for all files in the directory. This list is maintained so authors do not need to hardcode file paths, and instead can use the helper functions <em>get_file_path()</em>, <em>get_file_folder()</em>, <em>save_file()</em>, <em>read_file()</em>, and <em>source_file()</em>, which only require the authors to specify the file name and extension, and optionally, a folder path. This file can be updated by calling the <em>build_cabinet()</em> function, which stores the <em>cabinet</em> in the <em>Functions</em> folder as an RData file.</p>
<p><em>link_to_proj()</em> will search through all of the rfiles in the project directory for <em>library</em> and <em>require</em> keywords, parse the packages in these functions, and install them in the project’s library folder. The default library path is changed, which can be verified by calling <code>.libPaths()</code> and seeing the first item in the list being the path to the projects library folder. This will force RStudio to look in the project’s library folder for packages when loading them. This is <strong>projectmap’s</strong> package version control method.</p>
<p>If any of the <strong>bigrquery</strong>, <strong>bigQueryR</strong>, <strong>googledrive</strong>, or <strong>googlesheets</strong> packages are used in any of the projects R script, it will open up a browser window or tab and prompt the user to authenticate his or her access to Google BigQuery or Google Drive. The OAuth token will be stored in the projects root directory so this step can be avoided when running the scripts in the future. The packages may automatically update stale OAuth tokens, however.</p>
</div>
<div id="the-project-master-file" class="section level2">
<h2>The Project Master File</h2>
<p>The project master file is the main file for your project. The first thing you will notice is that the <em>init</em> argument in <em>link_to_proj()</em> is to <em>T</em>. This tells the function to initialize the project.</p>
<p>Next you will see the code chunk</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">set_proj_models</span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">Example =</span> T,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">Model1 =</span> F</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">)</a></code></pre></div>
<p>The names should be set by the author representing submodels of the overall model developed in the project. Each submodel should represent a logical part of the overall model that be run on its own. Once you have partitioned your model into submodels (you can also just run your model as one partition), you need to set it equal to <em>T</em> or <em>F</em> depending on whether you want the R scripts in that submodel to execute the next time you source <em>Project Master.R</em></p>
<p>The last item in the master file is the code chunk</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="cf">if</span>(<span class="kw">run_proj_model</span>(<span class="st">&quot;Example&quot;</span>)){</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="kw">source_file</span>(<span class="st">&quot;Example File.R&quot;</span>, <span class="dt">inFolder =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="cf">if</span>(<span class="kw">run_proj_model</span>(<span class="st">&quot;Model1&quot;</span>)){</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="kw">source_file</span>(<span class="st">&quot;Model1.R&quot;</span>, <span class="dt">inFolder =</span> <span class="st">&quot;Codes&quot;</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">}</a></code></pre></div>
<p>The <em>run_proj_model()</em> function returns <em>T</em> or <em>F</em> for the model string argument depending on what was set in the <em>set_proj_models()</em> function above. It is the authors’ responsibility to place all R scripts required to develop the model in this part of the master file in the correct order. The scripts should be called using the <em>source_file()</em> function as above. This is a wrapper to the base <em>source()</em> function, that keeps track of the overall progress of the master file’s execution. The <em>inFolder</em> argument is optional. If all your R scripts have unique names, you can leave as <em>NULL</em> which is the default. Otherwise, you can specify the folder path to the R script (i.e <em>Codes</em> or <em>Codes/Model 1</em>, if <em>Model1.R</em> lives that folder path).</p>
<p>To see how the master file executes, set the working directory to your projects root folder and type <code>source(&quot;Project Master.R&quot;)</code> in the console. Be sure to explore the output in the <em>Output</em> folder.</p>
</div>
<div id="the-example-file" class="section level2">
<h2>The Example file</h2>
<p>This file exists as a template for authors to follow when writing R scripts for the project. The only required function is <em>link_to_proj()</em>, which should be placed at the top after loading the <strong>projectmap</strong> package. Then, load all other required libraries for the R script.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#Load projectmap</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">library</span>(projectmap)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#Link this file as part of the project</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">link_to_proj</span>()</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#Load other required packages</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="kw">library</span>(data.table)</a></code></pre></div>
<p>This will prevent the script from loading packages from your main library and only look in the project library for the pacages. You should also place <em>rm(list = ls())</em> at the very top to make sure your R script exectues in a clean environment.</p>
<p>You will notice a couple examples of how to use the <em>save_file()</em> function for saving data and ggplot objects using _od_theme() and the <em>read_file()</em> function. You should use the <em>save_file()</em> for saving all objects as it is a wrapper function for <strong>data.table’s</strong> <em>fwrite()</em> for saving csv’s, <strong>ggplot2’s</strong> <em>ggsave()</em> for saving plots from ggplot objects, <strong>xlsx’s</strong> <em>saveWorkBook()</em> saving xls and xlsx files, and the base <em>save()</em> and <em>saveRDS()</em> for saving RData and rds files.More importantly, it runs some code on the back end to add all saved files to the <em>cabinet</em> so that they can referenced from other <strong>projectmap</strong> package helper functions.</p>
<p>The <em>save_file()</em> function will automatically select the proper function to use based on the extension given in the <em>file</em> argument. It will also select the default output directory using the <em>get_output_dir()</em> function. This helper function is designed to set up the <em>Output</em> folder to mimic the structure of the <em>Codes</em> folder. For exmaple, if <em>Model1.R</em> exists in <em>Codes/Model 1</em> then <em>get_output_dir()</em> will replace <em>Codes</em> with <em>Output</em> while keeping the <em>Model1</em> subfolder. You can also specify an extra subfolder if you would like to separater data from images output, for example, by adding a subfolder to the file name like <em>Images/plot.png</em>.</p>
<p>The Opendoor color names are “blue”, “navy”, “iris”, “turquoise”, “citrine”, “ruby”, “lightgrey”, “bluegrey”, “coolgrey”, “warmgrey”, and “lightgreytint”. The <em>od_theme()</em> is built with multiple palettes that can be selected by setting the <em>palette</em> argument to one of “main”, “cool”, or “warm”. The <em>main</em> color palette consists of all non-grey colors, the <em>cool</em> color palette consists of “navy”, “blue”, “bluegrey”, and “turquoise”. The <em>warm</em> color palette consists of “ruby”, “iris”, and “citrine”.</p>
<p>You can also select a subset of the Opendoor colors or naming your own colors by setting the <em>color</em> argument to a vector of color names or hexidecimal strings. Or, you can select a set number of colors by setting the <em>n</em> argument to any positive integer. If the color palette needs to continuous, make sure to set the <em>discrete</em> argument to <em>F</em> (it is <em>T</em> by default). You can also reverse the order of the color palette by setting the <em>reverse</em> argument to <em>T</em>. If you’d like to add black to the color palette (which is absent by default), you can do so by setting the <em>addblack</em> argument to <em>T</em>.</p>
<p>Finally, the <em>read_file()</em> function is a wrapper function for <strong>data.table’s</strong> <em>fread()</em> for reading in csv files, <strong>xlsx’s</strong> <em>read.xlsx()</em> for reading in xls and xlsx files, and the base <em>load()</em> and <em>readRDS()</em> files for reading in RData and rds files. You only need to specify the file name in the <em>file</em> argument with an extension if you know the file name is unique in the project directory. Otherwise, you can specify the folder path using the <em>inFolder</em> argument (i.e. <em>Output/Model 1/Images</em>). If you leave <em>inFolder</em> as <em>NULL</em>, <em>read_file()</em> will default to looking in the folder path decided by <em>get_output_dir()</em> for the file if multiple files exist with the same name but different folder paths.</p>
</div>
<div id="branching-and-merging" class="section level2">
<h2>Branching and Merging</h2>
<p>To allow multiple users to edit the same R file and perform version control, the <strong>projectmap</strong> package provides will set up the project root folder to work with git. The first step the user should take is to start an R project in this folder by opening up RStudio -&gt; File -&gt; New Project -&gt; Existing Directory and select the appropriate directory. You should see a “Git” tab next to the “Environment”, “History”, “Connections”, and “Build”, tabs.</p>
<p>To clone the directory to have a separate copy to work on and prevent unwanted changes to the master copy use:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(projectmap)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">git_clone</span>(<span class="dt">repo =</span> <span class="st">&quot;/Users/username/repo&quot;</span>, <span class="dt">directory =</span> <span class="st">&quot;/Users/username/Documents/repo&quot;</span>)</a></code></pre></div>
<p><em>git_clone()</em> is a shorthad for git terminal commands. The <strong>projectmaps</strong> packages initializes your repo with a .git folder and .gitignore file, and it also updates the git config file to update the master when receiving pushes from cloned directories. You should be able to use RStudios built in git interface when you open your created R project. The <strong>projectmap</strong> packages also includes some other git shorthand functions: <em>git_branch()</em>, <em>git_diff()</em>, <em>git_pull()</em>, <em>git_merge()</em>, and <em>git_push()</em> that can help with git functionality. Be sure to pull the master copy into your cloned copy before pushing back to the master copy.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
